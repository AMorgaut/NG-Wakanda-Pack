var sockets = [];self.onconnect = function (event) {    var port = event.ports[0];        // manage sockets vs server-threads    if (port.hasOwnProperty('binaryType')) {        socket.push(port);    }    // manage messages    port.onmessage = function (event) {        var data = event.data;		        switch (data.action) {        case 'connect':            port.userID = data.user;            break;        case 'broadcast':        var message = JSON.stringify(data.message);            sockets.forEach(function broadcast(socket) {            // broadcast to targets only            if (!data.targets || data.targets.indexOf(socket.userID) > -1) {	                    socket.postMessage(message);			            }        });        break;        }    };};